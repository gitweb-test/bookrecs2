<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simple Book Recommender</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 700px;
    margin: 2rem auto;
    padding: 0 1rem;
    background: #fafafa;
    color: #222;
  }
  h1 {
    text-align: center;
  }
  input, button {
    padding: 0.5rem;
    font-size: 1rem;
  }
  input {
    width: 70%;
  }
  button {
    width: 25%;
    margin-left: 1%;
    cursor: pointer;
  }
  #results {
    margin-top: 2rem;
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(140px,1fr));
    gap: 1rem;
  }
  .book {
    background: white;
    padding: 1rem;
    border-radius: 6px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    text-align: center;
  }
  .book img {
    height: 180px;
    object-fit: cover;
    margin-bottom: 0.5rem;
    border-radius: 4px;
  }
  .error {
    color: red;
    text-align: center;
    margin-top: 1rem;
  }
</style>
</head>
<body>

<h1>Book Recommender</h1>
<div>
  <input type="text" id="bookInput" placeholder="Enter a book title, e.g. The Hobbit" />
  <button id="searchBtn">Search</button>
</div>

<div id="results"></div>
<div id="error" class="error"></div>

<script>
  document.getElementById('searchBtn').addEventListener('click', async () => {
    const query = document.getElementById('bookInput').value.trim();
    const resultsDiv = document.getElementById('results');
    const errorDiv = document.getElementById('error');
    resultsDiv.innerHTML = '';
    errorDiv.textContent = '';

    if (!query) {
      errorDiv.textContent = 'Please enter a book title.';
      return;
    }

    resultsDiv.textContent = 'Loading...';

    try {
      // Search for the book by title
      const searchRes = await fetch(`https://openlibrary.org/search.json?title=${encodeURIComponent(query)}&limit=1`);
      const searchData = await searchRes.json();

      if (!searchData.docs.length) {
        resultsDiv.textContent = '';
        errorDiv.textContent = 'No book found with that title.';
        return;
      }

      const firstBook = searchData.docs[0];
      const workKey = firstBook.key; // e.g. "/works/OL123W"

      // Get work details to find subjects
      const workRes = await fetch(`https://openlibrary.org${workKey}.json`);
      const workData = await workRes.json();

      const subjects = workData.subjects || firstBook.subject_facet || [];

      if (subjects.length === 0) {
        resultsDiv.textContent = '';
        errorDiv.textContent = 'No subjects found for this book, so no recommendations available.';
        return;
      }

      // Use first subject to get related books
      const subject = encodeURIComponent(subjects[0]);

      const subjectRes = await fetch(`https://openlibrary.org/subjects/${subject}.json?limit=10`);
      const subjectData = await subjectRes.json();

      if (!subjectData.works || subjectData.works.length === 0) {
        resultsDiv.textContent = '';
        errorDiv.textContent = 'No recommendations found for this subject.';
        return;
      }

      // Display recommended books
      resultsDiv.innerHTML = '';

      subjectData.works.forEach(book => {
        const coverUrl = book.cover_id 
          ? `https://covers.openlibrary.org/b/id/${book.cover_id}-M.jpg`
          : 'https://via.placeholder.com/140x180?text=No+Cover';

        const author = book.authors && book.authors.length ? book.authors[0].name : '';

        const bookDiv = document.createElement('div');
        bookDiv.className = 'book';
        bookDiv.innerHTML = `
          <img src="${coverUrl}" alt="${book.title}">
          <strong>${book.title}</strong><br/>
          <em>${author}</em>
        `;

        resultsDiv.appendChild(bookDiv);
      });

    } catch (err) {
      resultsDiv.textContent = '';
      errorDiv.textContent = 'An error occurred. Please try again.';
      console.error(err);
    }
  });
</script>

</body>
</html>
