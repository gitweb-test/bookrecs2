<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gutendex Book Recommender</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 700px;
    margin: 2rem auto;
    padding: 0 1rem;
    background: #fafafa;
    color: #222;
  }
  h1 {
    text-align: center;
  }
  input, button {
    padding: 0.5rem;
    font-size: 1rem;
  }
  input {
    width: 70%;
  }
  button {
    width: 25%;
    margin-left: 1%;
    cursor: pointer;
  }
  #results, #recommendations {
    margin-top: 2rem;
  }
  .book {
    background: white;
    padding: 1rem;
    border-radius: 6px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    margin-bottom: 1rem;
  }
  .book-title {
    font-weight: bold;
    font-size: 1.2rem;
  }
  .book-author {
    font-style: italic;
    margin-bottom: 0.5rem;
  }
  .rec-list {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(140px,1fr));
    gap: 1rem;
  }
  .rec-book {
    background: white;
    padding: 0.5rem;
    border-radius: 6px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    text-align: center;
  }
  .rec-book img {
    height: 180px;
    object-fit: cover;
    margin-bottom: 0.3rem;
    border-radius: 4px;
  }
  .error {
    color: red;
    text-align: center;
    margin-top: 1rem;
  }
</style>
</head>
<body>

<h1>Gutendex Book Recommender</h1>

<div>
  <input type="text" id="bookInput" placeholder="Enter a book title, e.g. Pride and Prejudice" />
  <button id="searchBtn">Search</button>
</div>

<div id="results"></div>
<div id="recommendations"></div>
<div id="error" class="error"></div>

<script>
  const resultsDiv = document.getElementById('results');
  const recDiv = document.getElementById('recommendations');
  const errorDiv = document.getElementById('error');

  document.getElementById('searchBtn').addEventListener('click', async () => {
    const query = document.getElementById('bookInput').value.trim();
    resultsDiv.innerHTML = '';
    recDiv.innerHTML = '';
    errorDiv.textContent = '';

    if (!query) {
      errorDiv.textContent = 'Please enter a book title.';
      return;
    }

    resultsDiv.textContent = 'Searching...';

    try {
      // Search for books by title
      const searchRes = await fetch(`https://gutendex.com/books?search=${encodeURIComponent(query)}&page=1`);
      const searchData = await searchRes.json();

      if (!searchData.results.length) {
        resultsDiv.textContent = '';
        errorDiv.textContent = 'No book found with that title.';
        return;
      }

      // Take first matched book
      const book = searchData.results[0];

      // Show found book
      resultsDiv.innerHTML = `
        <div class="book">
          <div class="book-title">${book.title}</div>
          <div class="book-author">by ${book.authors.map(a => a.name).join(', ') || 'Unknown'}</div>
          <img src="${book.formats['image/jpeg'] || ''}" alt="${book.title}" style="max-height:250px; display:block; margin:auto;"/>
          <p><a href="${book.formats['text/html; charset=utf-8'] || book.formats['text/html'] || '#'}" target="_blank" rel="noopener">Read this book</a></p>
        </div>
      `;

      recDiv.textContent = 'Loading recommendations...';

      // Get recommendations: find other books by the same author(s)
      let authorName = book.authors.length ? book.authors[0].name : null;

      if (!authorName) {
        recDiv.textContent = 'No author info available, cannot generate recommendations.';
        return;
      }

      const recRes = await fetch(`https://gutendex.com/books?search=author:${encodeURIComponent(authorName)}&page=1`);
      const recData = await recRes.json();

      // Filter out the current book from recommendations
      const recBooks = recData.results.filter(b => b.id !== book.id);

      if (!recBooks.length) {
        recDiv.textContent = 'No recommendations found for this author.';
        return;
      }

      recDiv.innerHTML = `<h2>More books by ${authorName}</h2><div class="rec-list"></div>`;
      const recList = recDiv.querySelector('.rec-list');

      recBooks.slice(0, 10).forEach(b => {
        const cover = b.formats['image/jpeg'] || 'https://via.placeholder.com/140x180?text=No+Cover';
        const el = document.createElement('div');
        el.className = 'rec-book';
        el.innerHTML = `
          <img src="${cover}" alt="${b.title}" />
          <div><strong>${b.title}</strong></div>
        `;
        recList.appendChild(el);
      });

    } catch (e) {
      resultsDiv.textContent = '';
      recDiv.textContent = '';
      errorDiv.textContent = 'An error occurred. Please try again.';
      console.error(e);
    }
  });
</script>

</body>
</html>
